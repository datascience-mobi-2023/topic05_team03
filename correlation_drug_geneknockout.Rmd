Gelerntes
na.rm überspringt nur die werte, es löscht sie nicht 



```{r}

#this chuck contains code that wont be used

#zuerst die ccls ordnen, sodass bei prism und bei prism.achilles die gleiche reihenfolge der CCLs ist
#versuchen zuerst die correlation herauszufinden und dann die nas rausnehmen 
#die schnittmenge zwischen. prsim und achilles (350 geimeinsame gene )
#schleife, sodasss alle medikamente einmal druchgeangen werden
i=1
for (i in 1:dim(prism[2])) 
  (prism[,i])#durch alle meds iterieren

#fist remove all NAs
  i.remove = which(is.na(prism[,i]))
  i.new.prism = prism[-i.remove,i]
  #i.new.prism

#schleife, sodasss alle knockouts pro med durchgegangen werden 
  
  for (g in 1:dim(prism.achilles)[2])
  
    (prism.achilles[,g])#alle knockouts for 
    #die ccls raushauen, die NA haben (datacleaning)
    g.remove = which(is.na(prism[,g]))
    new.prism = prism[-g.remove,g]
    g.new.prism
    #correlation berechnen
    cor(i.new.prism,g.new.prism, method = "spearman")
    g = g+1
    
  i = i + 1
    
    
# noich ein mechanismus nötig, der bei beiden spaltren die ccls removed
# ein ende finden für g und i
```

```{r}
#lets try it with apply

#first the order of the CCls of prism is matched with the order of prism.achilles
copy_prism = prism

order_actual_prism=rownames(copy_prism)
order_target_prism = rownames(prism.achilles)
new_prism= copy_prism[match(order_target_prism, order_target_prism),]
#new_prism

cor_drug_gene <- apply(new_prism[,1:3], 2, function(x){ #first loop iterates through all columns of prism
  
   apply(prism.achilles[,1:5], 2, function(y){#second loop iterates through all columns of prsim.achilles for each gene
      #fist remove all NAs
    x.remove = which(is.na(x)) #detecting the postitions of the drugs scores with missing values
    y.remove = which(is.na(y))#detecting the postitions of the gene knockout scores with missing values
    y.new.prism = y[c(-y.remove, -x.remove)] #vector with CCls removed that had NA eitherr in y or x
    x.new.prism = x[c(-y.remove, -x.remove)]#vector with CCls removed that had NA eitherr in y or x
  cor(x.new.prism,y.new.prism, method = "spearman")
  #plot(x.new.prism, y.new.prism)
   }
   )
}
)
 
# 
```

```{r}
#lets find some biomarkers, that are linked with drug sensitivity of CCLs 

# first we want to extract the drug gene pairs that are highly correlated 

T = 0.8 #setting a threshold

copy_prism
actual_prism = rownames(prism)
target_prism = rownames(prism.exp)
treatment_prism = copy_prism[match(actual_prism, target_prism),]

apply(cor_drug_gene, function(p){ #p is one correlation value
 
   if (p > T)#filtering correlations below threshold
    treatment = colname(p) 
    i=treatment_prism[,treatment] # extracting the column with the IC50 values of the drug of one of the drug gene pairs in prism
    apply(prism.exp,2,function(k){#iterating through prism.exp
      i_remove = which(is.na(i))#removing NAs from the prsim column, prism.exp doesnt have any NA
      cleaned_i = i[-i_remove]
      cleaned_k = k[-i_remove]
      cor(cleaned_i, cleaned_k, method = "spearman")
    }
    )
}
)
```

```{r}
#same point, but with gene fitness
#lets find some biomarkers, that are linked with gene fitness of ccls
#CCLs are the same in cnv and prism
# first we want to extract the drug gene pairs that are highly correlated 

T = 0.8 #setting a threshold

rm <- which(rownames(prism.achilles) %in% rownames(prism.exp))
prism_achilles_congruent = prism.achilles[rm,] #selceting the ccl in achilles screen that also exist in prism.cnv

copy_prism.exp = copy(prism.exp)
actual_prism.exp = rownames(prism.exp)
target_prism.exp = rownames(prism_achilles_congruent)
prism.achilles_clean = copy_prism.exp[match(actual_prism.cnv, target_prism.cnv),]

apply(cor_drug_gene, function(p){ #p is one correlation value
 
   if (p > T)#filtering correlations below threshold
    gene_knockout = colname(p) 
    w=prism.achilles_clean[,gene_knockout] # extracting the column with the IC50 values of the drug of one of the drug gene pairs in prism
    apply(prism.exp,2,function(k){#iterating through prism.exp
    w.remove = which(is.na(w))
    w_clean = w[-w.remove]
    k_clean = k[-w.remove] 
      cor(w_clean, k_clean, method = "spearman")
    }
    )
}
)
```

```{r}
#CORRELATION DRUG SENSITIVITY/ CNV

copy_prism.cnv = copy(prism.cnv)
actual_prism.cnv = rownames(prism.cnv)
target_prism.cnv = rownames(prism_achilles_congruent)
prism.achilles_clean = copy_prism.cnv[match(actual_prism.cnv, target_prism.cnv),]
```


```{r}
#so wir wollen testen, ob das überhaupt lappt SIIUUUUU
v1 <- c(1,2,3,4,5,6,7)
remove.d = which(v1 == 2)
reomove.t = which(v1 == 3)
v2 = v1[-remove.d]
v2
v3 = v1[c(-remove.d, -reomove.t)]
v3
```


```{r}
#data ordnen: die ordung der zeilen von prsim.achilles wird an die ordnung der zeilen von prism angepasst

#copy_achilles= prism.achilles

#order_actual_achilles= rownames(copy_achilles)
#order_target_achilles = rownames(prism)
#new_prsim.achilles= copy_achilles[match(order_target_achilles, order_actual_achilles),]
#new_prsim.achilles
```
```{r}
#data ordnen: die ordung der zeilen von prsim wird an die ordnung der zeilen von prism. achilles angepasst


copy_prism = prism

order_actual_prism=rownames(copy_prism)
order_target_prism = rownames(prism.achilles)
new_prism= copy_prism[match(order_target_prism, order_target_prism),]
new_prism
```



```{r}

#removing all cell lines with missung values for one specific row
#sum(is.na(prism[,1]))
i.remove = which(is.na(prism[,1]))
#i.remove
new.prism1 = prism[-i.remove,1]
new.prism1

#remove CCLs with missing value for every row 
i.remove = which(is.na(prism[,i]))
#i.remove
new.prism = prism[-i.remove,i]
new.prism

```


```{r}

```


```{r}
x <- prism[,1]
y <- prism[,2]
#berechnen der correlation
cor(x,y, method = "spearman")
```
```{r}
#just checking if all CCls of the achilles dataset are represented in the prism dataset
matching.CLL = rownames(prism) %in% rownames(prism.achilles)
sum(matching.CLL)
```

```{r}
length(apply(prism, 1, mean))
```

```{r}
#test area
h1 = c(1,2,3,2,3,NA)
h2 = c(2,NA,2,4,3,5)
h3 = c(2,4,NA,3,5,4)
h4 = c(2,2,3,2,4,5)

H <- data.frame(h1,h2,h3,h4)
H

cor(H, method = "spearman")
```
```{r}
#just some tests

x= prism[,2]
y= prism[,80]


    x.remove = which(is.na(x))
    x.remove
    y.remove = which(is.na(y))
    y.remove
    
sum(is.na(x))
sum(is.na(y))
    y.new.prism = y[c(-y.remove, -x.remove)]#y is a vector of gene knockout scores without NAs for all CCLs
    y.new.prism
  x.new.prism = x[c(-y.remove, -x.remove)]
  x.new.prism
  cor(x.new.prism,y.new.prism, method = "spearman")
```


```{r}
```
```{r}
#testing if the "2" is reoved twice and NO IT IS NOT :)
v1 <- c(1,2,3,4,5,6,7,8,9,10)
rmv1 <- c(1,2)
rmv2 <- c(2,3)

v1[c(-rmv1, -rmv2)]
```
```{r}
#SPIELPLATZ
sum(rownames(prism.achilles) %in% rownames(prism.exp))
rm <- which(rownames(prism.achilles) %in% rownames(prism.exp))
rownames(prism.achilles[rm,])


```

```{r}
#SPIELPLATZ
sum(is.na(prism.cnv))
sum(rownames(prism.achilles) %in% rownames(prism.cnv))
sum(rownames(prism) %in% rownames(prism.cnv))

sum(rownames(prism.cnv) %in% rownames(prism.achilles))
sum(rownames(prism.cnv) %in% rownames(prism))
```

